# 🖱️ 커스텀 ROI 설정 가이드

---

## 📋 개요

**커스텀 ROI 설정** 기능을 사용하면 마우스 클릭으로 원하는 모양의 다각형 ROI를 직접 만들 수 있습니다!

---

## 🚀 빠른 시작

### **방법 1: 마우스 클릭으로 ROI 그리기 (추천)**

```bash
# 1. streamlit-image-coordinates 설치
pip install streamlit-image-coordinates

# 2. Streamlit 실행
streamlit run streamlit_app.py

# 3. ROI 편집 탭 → "🖱️ 마우스로 ROI 그리기" 클릭
```

#### **사용 방법**:

1. **"🖱️ 마우스로 ROI 그리기"** 버튼 클릭
2. **카메라 프리뷰 화면**에서 마우스로 클릭하여 점 추가
3. **최소 3개 이상의 점** 추가 (다각형 완성)
4. **ROI ID** 입력 (예: "Entry_Zone", "Exit_Zone")
5. **"✅ Polygon 저장"** 버튼 클릭

---

### **방법 2: 좌표 직접 입력**

streamlit-image-coordinates가 설치되지 않은 경우 좌표를 직접 입력할 수 있습니다:

1. **X 좌표, Y 좌표** 입력
2. **"➕ 점 추가"** 버튼 클릭
3. 최소 3개 점 추가 후 저장

---

## 🎯 ROI 자동 생성 옵션

### **⬅️➡️ 좌/우 2분할 (새로 추가!)**

화면을 좌측/우측 2개 영역으로 자동 분할:

```
┌─────────────┬─────────────┐
│             │             │
│  ROI_LEFT   │  ROI_RIGHT  │
│   (좌측)     │   (우측)     │
│             │             │
└─────────────┴─────────────┘
```

**사용 사례**:
- 출입구 모니터링 (입구/출구)
- 양방향 통로 감시
- 좌/우 구역 분리 감시

---

### **🎯 4사분면**

화면을 4등분:

```
┌──────────┬──────────┐
│  ROI1    │  ROI2    │
│ (좌상단)  │ (우상단)  │
├──────────┼──────────┤
│  ROI3    │  ROI4    │
│ (좌하단)  │ (우하단)  │
└──────────┴──────────┘
```

---

## 📐 커스텀 ROI 활용 예시

### **예시 1: 출입구 감시**

```
점 추가 순서:
1. 문 좌상단 (100, 150)
2. 문 우상단 (300, 150)
3. 문 우하단 (350, 450)
4. 문 좌하단 (50, 450)

ROI ID: "Entry_Door"
```

### **예시 2: 복도 L자 영역**

```
점 추가 순서:
1. (50, 50)
2. (200, 50)
3. (200, 300)
4. (400, 300)
5. (400, 500)
6. (50, 500)

ROI ID: "Corridor_L"
```

### **예시 3: 원형 근사 (8각형)**

```
점 추가 순서:
중심 (400, 300), 반지름 150 기준으로
8개 점을 원형으로 배치

ROI ID: "Circular_Zone"
```

---

## 🛠️ 편집 기능

### **점 삭제**

- 각 점 옆의 **🗑️** 버튼 클릭
- 잘못 추가한 점을 개별 삭제

### **Polygon 초기화**

- **"🔄 현재 Polygon 초기화"** 버튼
- 모든 점을 삭제하고 다시 시작

### **ROI 선택**

- 저장된 ROI 목록에서 **"🎯 선택"** 버튼
- 선택된 ROI는 노란색으로 하이라이트

### **ROI 삭제**

- 저장된 ROI 목록에서 **"🗑️ 삭제"** 버튼
- 개별 ROI 삭제

### **모든 ROI 초기화**

- **"🧹 모든 ROI 초기화"** 버튼
- 모든 저장된 ROI를 한 번에 삭제

---

## 📊 ROI 정보 표시

### **카메라 프리뷰에서**

- **초록색**: 사람 검출 안 됨
- **빨간색**: 사람 검출됨
- **노란색**: 선택된 ROI
- **점 번호**: 각 꼭지점에 번호 표시

### **ROI 목록에서**

```
ROI1 (4개 점)
  타입: polygon
  설명: 새 ROI 영역
  [🎯 선택] [🗑️ 삭제]
```

---

## 🔧 문제 해결

### ❌ 마우스 클릭이 작동하지 않음

```bash
# streamlit-image-coordinates 설치 확인
pip install streamlit-image-coordinates

# Streamlit 재시작
streamlit run streamlit_app.py
```

### ❌ "⚠️ Polygon을 완성하려면 최소 3개의 점이 필요합니다"

- 최소 3개 이상의 점을 추가해야 Polygon을 저장할 수 있습니다
- 점을 더 추가한 후 저장하세요

### ❌ ROI가 화면에 표시되지 않음

- **"💾 설정 저장"** 버튼을 눌러 config.json에 저장했는지 확인
- Streamlit을 새로고침 (F5)

### ❌ 카메라 프레임을 가져올 수 없음

- 카메라 번호를 확인하세요
- **"🔍 카메라 자동 검색"** 버튼 사용

---

## 💡 팁 & 트릭

### **정확한 ROI 그리기**

1. 카메라를 고정된 위치에 설치
2. 조명이 충분한 환경에서 설정
3. 실제 감시할 영역을 카메라로 비춤
4. 관심 영역만 정확하게 마킹

### **복잡한 ROI 만들기**

- 점을 많이 추가할수록 정교한 모양 가능
- 하지만 4-6개 점이면 대부분의 영역 표현 가능
- 너무 복잡하면 성능 저하 가능

### **ROI ID 네이밍 규칙**

```
✅ 좋은 예:
- Entry_Door
- Exit_Zone
- Corridor_A
- Room_101

❌ 나쁜 예:
- ROI1 (의미 없음)
- 통로 (한글, 공백 포함)
- zone-1 (특수문자)
```

### **설정 저장 습관**

- ROI를 추가/수정할 때마다 **"💾 설정 저장"** 버튼 클릭
- config.json에 저장되어 다음 실행 시 자동 로드

---

## 🎓 강의 활용

### **ROI 설정 실습 (10분)**

1. **이론** (3분): ROI 개념, Polygon 설명
2. **데모** (3분): 마우스로 ROI 그리기 시연
3. **실습** (4분): 학생들이 직접 ROI 생성

---

## 📚 관련 문서

- **README_STREAMLIT.md**: Streamlit UI 전체 가이드
- **QUICKSTART_JETSON.md**: Jetson Orin 빠른 시작
- **roi_utils.py**: ROI 유틸리티 함수 코드

---

## ✅ 체크리스트

ROI 설정 전 확인:

- [ ] 카메라 정상 작동 확인
- [ ] 카메라 위치 고정
- [ ] 감시할 영역 결정
- [ ] streamlit-image-coordinates 설치 (마우스 클릭용)
- [ ] ROI 3개 이상 점 추가
- [ ] ROI ID 의미 있게 작성
- [ ] 설정 저장 (💾 버튼)
- [ ] 실시간 검출로 테스트

---

## 🎉 요약

**커스텀 ROI 3단계**:

```bash
# 1. 설치
pip install streamlit-image-coordinates

# 2. 실행
streamlit run streamlit_app.py

# 3. 클릭으로 ROI 그리기
"🖱️ 마우스로 ROI 그리기" → 화면 클릭 → 저장!
```

**이제 원하는 모양의 ROI를 자유롭게 만들 수 있습니다!** 🖱️✨

---

📍 **GitHub**: https://github.com/futurianh1k/roidetyolo
